<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Board | CODE</title>
  <!-- âœ… Tailwind CSS ì ìš© -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#232427] text-[#e5e7eb]">

  <!-- í˜ì´ì§€ ìƒë‹¨ ì œëª© "Board" í‘œì‹œ
      Tailwindë¥¼ ì‚¬ìš©í•´ ì¤‘ì•™ ì •ë ¬ ë° íŒ¨ë”© ì ìš©-->
  <header class="py-10 flex justify-center">
    <h1 class="text-5xl font-bold">Board</h1>
  </header>

  <!-- âœ… ê²Œì‹œê¸€ ì‘ì„± í¼ 
      ì œëª© ì…ë ¥ input: id="title" 
      ë‚´ìš© ì…ë ¥ textarea: id="content"
      íŒŒì¼ ì—…ë¡œë“œ input: id="fileInput"
      ë“±ë¡ ë²„íŠ¼: <button>ë“±ë¡</button>
      ì´ í¼ì€ ëª¨ë‘ ì‚¬ìš©ìê°€ ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ê¸° ìœ„í•œ ì…ë ¥ ì˜ì—­-->
  <main class="max-w-3xl mx-auto mt-10 bg-[#2b2c30] p-6 rounded-xl shadow space-y-6">

    <!-- ì œëª© ì…ë ¥ -->
    <div>
      <label for="title" class="block mb-2 text-sm font-semibold text-gray-300">ì œëª©</label>
      <input id="title" type="text" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
             class="w-full px-4 py-2 bg-[#40414f] text-white border border-[#565869] rounded focus:outline-none focus:ring-2 focus:ring-[#10a37f]">
    </div>

    <!-- ë‚´ìš© ì…ë ¥ -->
    <div>
      <label for="content" class="block mb-2 text-sm font-semibold text-gray-300">ë‚´ìš©</label>
      <textarea id="content" rows="8" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                class="w-full px-4 py-2 bg-[#40414f] text-white border border-[#565869] rounded focus:outline-none focus:ring-2 focus:ring-[#10a37f]"></textarea>
    </div>

    <!-- ì²¨ë¶€íŒŒì¼ ì…ë ¥ -->
    <div>
      <label for="fileInput" class="block mb-2 text-sm font-semibold text-gray-300">ì²¨ë¶€íŒŒì¼</label>
      <input id="fileInput" type="file"
             class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4
                    file:rounded file:border-0 file:text-sm file:font-semibold
                    file:bg-[#10a37f] file:text-white hover:file:bg-[#0d8f6d]" />
    </div>    

    <!-- ë“±ë¡ ë²„íŠ¼ -->
    <div class="text-right">
      <button class="bg-[#10a37f] hover:bg-[#0d8f6d] text-white font-semibold px-6 py-2 rounded">
        ë“±ë¡
      </button>
    </div>

  </main>

  <script>
    const button = document.querySelector("button");

    /** ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
        ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ê³ , ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œë¥¼ redirect íŒŒë¼ë¯¸í„°ë¡œ ê°™ì´ ë„˜ê²¨ì„œ ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ëŒì•„ì˜¤ê²Œ í•¨**/
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    // ğŸ” ë¡œê·¸ì¸ í™•ì¸: ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
    if (!currentUser) {
      alert("ë¡œê·¸ì¸ í›„ì— ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      window.location.href = `login.html?redirect=${encodeURIComponent(location.href)}`;
    }

    // ê²Œì‹œê¸€ ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ
    button.addEventListener("click", async () => {
      const title = document.getElementById("title").value.trim();
      const content = document.getElementById("content").value.trim();
      const file = document.getElementById("fileInput").files[0];
      const token = JSON.parse(localStorage.getItem("token")); // JWT í† í°ì„ localStorageì— ì €ì¥í•´ë‘ì—ˆë‹¤ë©´

      if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");

      const res = await fetch("http://localhost:4000/posts", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({
          title,
          content,
          fileName: file ? file.name : ""
        })
      });

      const data = await res.json();
      if (res.ok) {
        alert("ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        window.location.href = "index.html";
      } else {
        alert(`ì˜¤ë¥˜: ${data.message}`);
      }
    });
  </script>

</body>
</html>
