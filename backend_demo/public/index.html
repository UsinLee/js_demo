<!-- HTML ë¬¸ì„œì„ì„ ì„ ì–¸í•˜ëŠ” <!DOCTYPE html>ê³¼ ë¬¸ì„œì˜ ê¸°ë³¸ ì–¸ì–´ë¥¼ í•œêµ­ì–´(ko)ë¡œ ì„¤ì •í•œ íƒœê·¸ -->
<!DOCTYPE html> 
<html lang="ko">
<!-- head ë‚´ë¶€ì—ì„œ ë¬¸ì ì¸ì½”ë”© ì„¤ì •(UTF-8), ë°˜ì‘í˜• ì„¤ì •(viewport), ì œëª© ì„¤ì •, Tailwind CSSë¥¼ ì™¸ë¶€ CDNìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° -->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CODE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<!-- ë³¸ë¬¸ ë°°ê²½ìƒ‰ê³¼ ê¸€ììƒ‰ì„ ì„¤ì •í•˜ê³ , ì „ì²´ ë ˆì´ì•„ì›ƒì„ ê°€ìš´ë° ì •ë ¬(mx-auto), ìœ„ìª½ ì—¬ë°±(mt-10), í•­ëª© ê°„ ì—¬ë°±(space-y-6)ìœ¼ë¡œ ì •ë¦¬ -->
<body class="bg-[#232427] text-[#e5e7eb]">
  <div class="max-w-3xl mx-auto mt-10 space-y-6">
    <!-- ì´ ë¶€ë¶„ì€ í˜ì´ì§€ ìƒë‹¨ì— ì œëª©ì„ í‘œì‹œí•˜ëŠ” ì˜ì—­ -->
    <div class="board-wrapper">
      <!-- py-10ì€ ìœ„ì•„ë˜ íŒ¨ë”©ì„ í¬ê²Œ ì¤˜ì„œ ì œëª©ê³¼ ë‹¤ë¥¸ ìš”ì†Œë“¤ ì‚¬ì´ì˜ ê°„ê²©ì„ í™•ë³´í•´ì£¼ê³ ,
          flex justify-center items-centerëŠ” ì œëª©ì„ ê°€ë¡œÂ·ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬í•´.-->
      <header class="py-10 flex justify-center items-center ">
          <!-- text-5xl font-boldëŠ” í…ìŠ¤íŠ¸ í¬ê¸°ì™€ êµµê¸°, text-whiteëŠ” ìƒ‰ìƒì„ í•˜ì–—ê²Œ ì„¤ì • -->
          <h1 class="text-5xl font-bold">
            <a href="index.html" class="text-white hover:underline">CODE</a>
          </h1>
          
          
      </header>
    </div>

    <!-- ì´ ë¶€ë¶„ì€ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í‘œì‹œí•˜ëŠ” ì˜ì—­ -->  
    <div class="flex justify-end items-center gap-4">
      <!-- âœ… ë¡œê·¸ì¸ ìƒíƒœ or ë¡œê·¸ì¸ ë²„íŠ¼ -->
      <!-- loginStatusëŠ” ë¡œê·¸ì¸ ìƒíƒœ ë©”ì‹œì§€ë‚˜ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ë™ì ìœ¼ë¡œ í‘œì‹œí•˜ê¸° ìœ„í•œ div-->
      <div id="loginStatus" class="text-sm text-gray-400"></div>
      <!-- ğŸ”“ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
      <!--logoutBtnì€ ë¡œê·¸ì¸í•œ ê²½ìš° ë³´ì´ê²Œ ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼, ê¸°ë³¸ ìƒíƒœì—ì„œëŠ” hidden í´ë˜ìŠ¤ë¡œ ìˆ¨ê²¨ì ¸ ìˆìŒ-->
      <button id="logoutBtn" class="text-sm text-red-400 hover:underline hidden">ë¡œê·¸ì•„ì›ƒ</button>      
    </div>
    
    <!--ì‹¤ì œ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ê°€ ì¶œë ¥ë  ì˜ì—­, JavaScriptì—ì„œ ì´ divì— ê²Œì‹œê¸€ í•­ëª©ë“¤ì„ innerHTMLë¡œ ë„£ì–´ì¤Œ-->
    <!-- bg-[#2b2c30]ì€ ë°°ê²½ìƒ‰, rounded-xlì€ ëª¨ì„œë¦¬ ë‘¥ê¸€ê¸°, shadowëŠ” ê·¸ë¦¼ì íš¨ê³¼.
        mt-8ì€ ìƒë‹¨ ì—¬ë°±, mx-autoëŠ” ê°€ìš´ë° ì •ë ¬-->
    <!-- id="postList": ê²Œì‹œê¸€ ëª©ë¡ì´ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë¨ -->
    <div id="postList" class="max-w-3xl mx-auto mt-8 bg-[#2b2c30] rounded-xl shadow pd-10">
      <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    </div>



    <!-- max-w-3xl: ìµœëŒ€ ë„ˆë¹„ë¥¼ ì„¤ì •í•´ì„œ í˜ì´ì§€ ê°€ìš´ë°ë¡œ ì •ë ¬ë˜ê²Œ.
        mx-auto: ì–‘ìª½ ë§ˆì§„ì„ ìë™ìœ¼ë¡œ, ì¦‰ ê°€ìš´ë° ì •ë ¬.
        mt-8: ìœ„ìª½ ì—¬ë°± (margin-top: 2rem)
        flex justify-between items-center: í”Œë ‰ìŠ¤ ë°•ìŠ¤ë¡œ ë§Œë“¤ì–´ì„œ ì–‘ìª½ì— ìš”ì†Œë¥¼ ë°°ì¹˜. í˜ì´ì§€ ë²ˆí˜¸ + ê¸€ì“°ê¸° ë²„íŠ¼
        px-2: ì¢Œìš°ì— ì•½ê°„ì˜ íŒ¨ë”©ì„ ì¶”ê°€í•´ì„œ ì‚´ì§ ì—¬ìœ  ì¤Œ-->
    <div class="max-w-3xl mx-auto mt-8 flex justify-between items-center px-2">
      <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
      
      <!-- ê²Œì‹œê¸€ ì‘ì„± ë²„íŠ¼ -->
      <!-- ml-auto: margin-left: auto â†’ ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ ì •ë ¬í•´ì¤Œ-->
      <div class="ml-auto">
          <!-- a íƒœê·¸: ê¸€ì“°ê¸° í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë§í¬ (board_create.html)
              ë²„íŠ¼ ìŠ¤íƒ€ì¼:
              bg-[#10a37f]: ì´ˆë¡ìƒ‰ ë°°ê²½
              hover:bg-[#0d8f6d]: ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ì–´ë‘ìš´ ì´ˆë¡
              text-white: ê¸€ììƒ‰
              px-4 py-2: íŒ¨ë”© (ë²„íŠ¼ ì‚¬ì´ì¦ˆ)
              rounded: í…Œë‘ë¦¬ ë‘¥ê¸€ê²Œ
              text-sm font-medium: ì‘ì€ ê¸€ì”¨, ì¤‘ê°„ êµµê¸°-->
          <a href="/board_create.html" 
            class="bg-[#10a37f] hover:bg-[#0d8f6d] text-white px-4 py-2 rounded text-sm font-medium">
            ê¸€ì“°ê¸°
          </a>
        </div>
    </div>

    <!-- max-w-3xl mx-auto mt-8 flex items-center gap-2 px-2
        ì—­ì‹œ ì¤‘ì•™ ì •ë ¬ (mx-auto) + ìœ„ ì—¬ë°± (mt-8) + flexë¡œ ê°€ë¡œ ë°°ì¹˜
        gap-2: inputê³¼ button ì‚¬ì´ì— ê³µê°„ ì¤Œ
        items-center: ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬-->
    <div class="max-w-3xl mx-auto mt-8 flex items-center gap-2 px-2">
      <!-- ê²€ìƒ‰ ì°½ -->
      <!-- id="searchInput": ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ID
          placeholder="ì œëª© ê²€ìƒ‰": ì…ë ¥ ì¹¸ì— íë¦¿í•˜ê²Œ ë³´ì´ëŠ” ì•ˆë‚´ë¬¸
          flex-grow: inputì´ ê°€ë¡œë¡œ ê°€ëŠ¥í•œ ìµœëŒ€ ë„ˆë¹„ë¥¼ ì°¨ì§€
          bg-[#40414f]: ì§„í•œ íšŒìƒ‰ ë°°ê²½
          text-white, border, rounded: ì‹œê°ì ìœ¼ë¡œ ê¹”ë”í•œ ì…ë ¥ì°½-->
      <input
        id="searchInput"
        type="text"
        placeholder="ì œëª© ê²€ìƒ‰"
        class="flex-grow px-4 py-2 bg-[#40414f] text-white border border-[#565869] rounded"
      />
      <!-- id="searchBtn": ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì— ì—°ê²°
          ìŠ¤íƒ€ì¼ì€ ìœ„ ê¸€ì“°ê¸° ë²„íŠ¼ê³¼ ìœ ì‚¬ (ì´ˆë¡ìƒ‰ ë°°ê²½, ë‘¥ê·¼ ëª¨ì„œë¦¬, hover íš¨ê³¼)-->
      <button
        id="searchBtn"
        class="bg-[#10a37f] hover:bg-[#0d8f6d] text-white px-4 py-2 rounded">
        ê²€ìƒ‰
      </button>
    </div>
    <!-- id="pagination": í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ì´ ë“¤ì–´ê° (JavaScriptì—ì„œ renderPagination() í•¨ìˆ˜ë¡œ ê·¸ë ¤ì§)-->
    <div id="pagination" class="flex justify-center mt-6 gap-2 text-sm text-gray-400"></div>
  </div>
  
  <script>
    const postList = document.getElementById('postList');
    const loginStatus = document.getElementById("loginStatus");
    const logoutBtn = document.getElementById("logoutBtn");
  
    let posts = [];
    const postsPerPage = 10;
    let currentPage = Math.ceil(posts.length / postsPerPage);
  
    /** âœ… ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì²˜ë¦¬ **/
    function updateLoginUI() {
      const loginStatus = document.getElementById("loginStatus");
      const logoutBtn = document.getElementById("logoutBtn");

      const storedUser = localStorage.getItem("currentUser");
      let userInfo = null;

      try {
        if (storedUser) {
          userInfo = JSON.parse(storedUser);
        }
      } catch (err) {
        console.error("âš ï¸ currentUser íŒŒì‹± ì‹¤íŒ¨:", err);
      }
      
      if (userInfo) {
        loginStatus.textContent = `ğŸ‘‹ ${userInfo.username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
        logoutBtn.classList.remove("hidden");
      } else {
        const currentUrl = encodeURIComponent(location.href);
        loginStatus.innerHTML = `<a href="login.html?redirect=${currentUrl}" class="text-blue-400 hover:underline">ğŸ” ë¡œê·¸ì¸</a>`;
        logoutBtn.classList.add("hidden");
      }
    }
  
    logoutBtn.addEventListener("click", () => {
      if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        localStorage.removeItem("currentUser");
        localStorage.removeItem("token");
        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        location.reload();
      }
    });
  
    /** âœ… ê²Œì‹œê¸€ ë Œë”ë§ í•¨ìˆ˜ **/
    function renderPosts(postsArray, page = 1) {
      postList.innerHTML = "";
  
      const totalPages = Math.ceil(postsArray.length / postsPerPage);
      const startIndex = (totalPages - page) * postsPerPage;
      const endIndex = startIndex + postsPerPage;
      const paginatedPosts = postsArray.slice(startIndex, endIndex);
  
      paginatedPosts.forEach((post, idx) => {
        const postNumber = postsArray.length - (startIndex + idx);
        const date = new Date(post.date);
        const formattedDate = date.toLocaleString("ko-KR", {
          year: "2-digit",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit"
        }).replace(/\./g, '-').replace(/\s/g, '');
  
        const el = document.createElement("div");
        el.className = "flex items-center py-2 px-4 text-sm text-gray-300";
        el.innerHTML = `
          <div class="w-1/6 text-left">${postNumber}</div>
          <div class="w-3/6 text-center truncate">
            <a href="board_view.html?index=${post.id}" class="hover:underline text-white">${post.title}</a>
          </div>
          <div class="w-2/6 text-right">${formattedDate}</div>
        `;
        postList.appendChild(el);
      });
  
      renderPagination(postsArray);
    }
  
    /** âœ… í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ í•¨ìˆ˜ **/
    function renderPagination(postsArray) {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
  
      const totalPages = Math.ceil(postsArray.length / postsPerPage);
      const groupSize = 10;
      const groupStart = Math.floor((currentPage - 1) / groupSize) * groupSize + 1;
      const groupEnd = Math.min(groupStart + groupSize - 1, totalPages);
  
      // â­ ì²« í˜ì´ì§€ë¡œ ì´ë™
      const toFirst = document.createElement("button");
      toFirst.textContent = "â­";
      toFirst.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
      toFirst.addEventListener("click", () => {
        currentPage = 1;
        renderPosts(postsArray, currentPage);
      });
      pagination.appendChild(toFirst);
  
      // â–¶ ì´ì „ í˜ì´ì§€ ê·¸ë£¹
      if (groupStart > 1) {
        const prev = document.createElement("button");
        prev.textContent = "â–¶";
        prev.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
        prev.addEventListener("click", () => {
          currentPage = groupStart - 1;
          renderPosts(postsArray, currentPage);
        });
        pagination.appendChild(prev);
      }
  
      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼
      for (let i = groupEnd; i >= groupStart; i--) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded hover:bg-[#3a3b3e] ${i === currentPage ? "bg-[#10a37f] text-white" : ""}`;
        btn.addEventListener("click", () => {
          currentPage = i;
          renderPosts(postsArray, currentPage);
        });
        pagination.appendChild(btn);
      }
  
      // â—€ ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹
      if (groupEnd < totalPages) {
        const next = document.createElement("button");
        next.textContent = "â—€";
        next.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
        next.addEventListener("click", () => {
          currentPage = groupEnd + 1;
          renderPosts(postsArray, currentPage);
        });
        pagination.appendChild(next);
      }
  
      // â® ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™
      const toLast = document.createElement("button");
      toLast.textContent = "â®";
      toLast.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
      toLast.addEventListener("click", () => {
        currentPage = totalPages;
        renderPosts(postsArray, currentPage);
      });
      pagination.appendChild(toLast);
    }
  
    /** âœ… ê²€ìƒ‰ ê¸°ëŠ¥ **/
    document.getElementById("searchBtn").addEventListener("click", () => {
      const keyword = document.getElementById("searchInput").value.toLowerCase();
  
      const filtered = posts.filter(post =>
        post.title.toLowerCase().includes(keyword)
      );
  
      if (keyword === "") {
        document.getElementById("pagination").style.display = "flex";
        renderPosts(posts, currentPage);
      } else {
        document.getElementById("pagination").style.display = "none";
        renderPosts(filtered, 1);
      }
    });
  
    /** âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° + ì´ˆê¸° ë Œë”ë§ **/
    window.addEventListener("DOMContentLoaded", () => {
      updateLoginUI();
  
      fetch("http://localhost:4000/posts")
        .then(res => res.json())
        .then(data => {
          posts = data.sort((a, b) => b.id - a.id); // ìµœì‹ ìˆœ ì •ë ¬
          currentPage = Math.ceil(posts.length / postsPerPage);
          renderPosts(posts, currentPage);
        })
        .catch(err => {
          console.error("ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
          postList.innerHTML = `<p class="text-center text-red-400 mt-4">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>`;
        });
    });
  
    /** âœ… ë’¤ë¡œ ê°€ê¸° ì‹œ ìºì‹œëœ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ **/
    window.addEventListener("pageshow", (event) => {
      const navType = performance.getEntriesByType("navigation")[0]?.type;
      if (event.persisted || navType === "back_forward") {
        location.reload();
      }
    });
  </script>
  
  
  
</body>
</html>
