<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CODE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#232427] text-[#e5e7eb]">
  <div class="board-wrapper">
    <!-- ì œëª© -->
    <header class="py-10 flex justify-center items-center border-b border-[#2e2f33]">
        <h1 class="text-5xl font-bold text-white">CODE</h1>
    </header>
  </div>

  <div id="postList" class="max-w-3xl mx-auto mt-8 bg-[#2b2c30] rounded-xl shadow">
    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->

  </div>

  <div class="max-w-3xl mx-auto mt-8 flex justify-between items-center px-2">
    <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
    
    <!-- ê²Œì‹œê¸€ ì‘ì„± ë²„íŠ¼ -->
    <div class="ml-auto">
        <a href="/board_create.html" 
           class="bg-[#10a37f] hover:bg-[#0d8f6d] text-white px-4 py-2 rounded text-sm font-medium">
          ê¸€ì“°ê¸°
        </a>
      </div>
  </div>

  <div class="max-w-3xl mx-auto mt-8 flex items-center gap-2 px-2">
    <!-- ê²€ìƒ‰ ì°½ -->
    <input
      id="searchInput"
      type="text"
      placeholder="ì œëª© ê²€ìƒ‰"
      class="flex-grow px-4 py-2 bg-[#40414f] text-white border border-[#565869] rounded"
    />
    <button
      id="searchBtn"
      class="bg-[#10a37f] hover:bg-[#0d8f6d] text-white px-4 py-2 rounded">
      ê²€ìƒ‰
    </button>
  </div>

  <div id="pagination" class="flex justify-center mt-6 gap-2 text-sm text-gray-400"></div>

  <script>
    const postList = document.getElementById('postList');
    const posts = JSON.parse(localStorage.getItem("posts") || "[]");

    const postsPerPage = 10;
    const totalPages = Math.ceil(posts.length / postsPerPage);
    let currentPage = totalPages; // ë§ˆì§€ë§‰ í˜ì´ì§€ë¶€í„° ì‹œì‘!

    // ğŸ” ì´ˆê¸° ì „ì²´ ì¶œë ¥
    renderPosts(currentPage);

    // ğŸ”¥ ê³µí†µ ë Œë”ë§ í•¨ìˆ˜
    function renderPosts(page = 1) {
      postList.innerHTML = "";
    
      // 1. ìµœì‹ ê¸€ì´ ë¨¼ì € ì˜¤ë„ë¡ ì •ë ¬
      const sortedPosts = [...posts].map((post, i) => ({
        ...post,
        index: i,
        number: posts.length - i, // ê²Œì‹œë¬¼ ë²ˆí˜¸ (1ë¶€í„° ì‹œì‘, ìµœì‹ ì´ ê°€ì¥ ì‘ì€ ë²ˆí˜¸)
      }));
    
      // 2. í˜ì´ì§€ ë²ˆí˜¸ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œë¬¼ ë²ˆí˜¸ ë²”ìœ„ êµ¬í•¨
      const startNum = (page - 1) * postsPerPage + 1;
      const endNum = page * postsPerPage;
    
      // 3. ê²Œì‹œë¬¼ ë²ˆí˜¸ ê¸°ì¤€ìœ¼ë¡œ ê±¸ëŸ¬ëƒ„
      const paginatedPosts = sortedPosts.filter(
        post => post.number >= startNum && post.number <= endNum
      );
    
      // 4. ê²Œì‹œë¬¼ ë Œë”ë§
      paginatedPosts.forEach((post) => {
        const date = new Date(post.date);
        const formattedDate = date.toLocaleString("ko-KR", {
          year: "2-digit",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        }).replace(/\./g, '-').replace(/\s/g, '');
    
        const el = document.createElement("div");
        el.className = "flex items-center border-b border-[#3a3b3e] py-2 px-4 text-sm text-gray-300";
    
        el.innerHTML = `
          <div class="w-1/6 text-left">${post.number}</div>
          <div class="w-3/6 text-center truncate">
            <a href="board_view.html?index=${post.index}" class="hover:underline text-white">${post.title}</a>
          </div>
          <div class="w-2/6 text-right">${formattedDate}</div>
        `;
    
        postList.appendChild(el);
      });
    
      renderPagination();
    }
    
    

    function renderPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
    
      const totalPages = Math.ceil(posts.length / postsPerPage);
    
      const groupSize = 10; // ğŸ”¥ í•œ ë²ˆì— ë³´ì—¬ì¤„ í˜ì´ì§€ ìˆ˜
      const groupStart = Math.floor((currentPage - 1) / groupSize) * groupSize + 1;
      const groupEnd = Math.min(groupStart + groupSize - 1, totalPages);
    
      // â—€ ì™¼ìª½ í™”ì‚´í‘œ â†’ ë‹¤ìŒ ê·¸ë£¹ (ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™)
      if (groupEnd < totalPages) {
        const next = document.createElement("button");
        next.textContent = "â—€";
        next.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
        next.addEventListener("click", () => {
          currentPage = groupEnd + 1;
          renderPosts(currentPage);
        });
        pagination.appendChild(next);
      }
    
      // í˜ì´ì§€ ë²ˆí˜¸
      for (let i = groupEnd; i >= groupStart; i--) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded hover:bg-[#3a3b3e] ${
          i === currentPage ? "bg-[#10a37f] text-white" : ""
        }`;
        btn.addEventListener("click", () => {
          currentPage = i;
          renderPosts(currentPage);
        });
        pagination.appendChild(btn);
      }
    
      // â–¶ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ â†’ ì´ì „ ê·¸ë£¹ (ì™¼ìª½ìœ¼ë¡œ ì´ë™)
      if (groupStart > 1) {
        const prev = document.createElement("button");
        prev.textContent = "â–¶";
        prev.className = "px-2 py-1 text-sm text-gray-400 hover:text-white";
        prev.addEventListener("click", () => {
          currentPage = groupStart - 1;
          renderPosts(currentPage);
        });
        pagination.appendChild(prev);
      }
    }
    
    

    


    // ğŸ” ê²€ìƒ‰ ê¸°ëŠ¥
    document.getElementById("searchBtn").addEventListener("click", () => {
      const keyword = document.getElementById("searchInput").value.toLowerCase();

      const filtered = posts
        .map((post, index) => ({ post, index })) // â† ì—¬ê¸°ì„œ index ìœ ì§€
        .filter(({ post }) => post.title.toLowerCase().includes(keyword));

      renderPosts(filtered);
    });

  </script>
  
</body>
</html>
